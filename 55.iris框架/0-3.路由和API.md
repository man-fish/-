## Handler

![image-20200116194947758](F:\我的笔记\55.iris框架\assets\image-20200116194947758.png)

一个 `Handler`，正如其名，用于处理请求，之后来看看源码中的注释。

```go
/** 
    一个handler函数处理程序用于响应 HTTP 请求，它把响应头和数据写入 Context.ResponseWriter() 然后返回请求完成的的信号。在请求完成之后是不能使用上下文的。在写入 context.ResponseWriter() 之后可能无法从 Context.Request().Body 读取内容。严谨的处理程序应该首先读取 Context.Request().Body ，然后再响应。除了读取请求体，处理程序不应该更改修改提供的上下文。如果处理程序崩溃掉，服务器任务崩溃只是影响了当前的请求。恢复之后，记录错误日志中然后挂断连接。
*/
type Handler func(Context)
```

一旦处理程序被注册，我们就可以使用返回的 [`Route`](https://godoc.org/github.com/kataras/iris/core/router#Route) 实例为处理程序注册命名，以便在代码或模板中更容易查找。

## API

所有的 `HTTP` 方法都支持，开发者可以为相同路径的处理程序注册不同的方法。

第一个参数是 `HTTP` 方法，第二个参数是路由路径，第三个可变参数应该包含一个或者多个 `iris.Handler`，当获取某个资源的请求从服务器到来时，处理器按照注册顺序被调用执行。

**示例代码:**

```php
app := iris.New()

app.Handle("GET", "/contact", func(ctx iris.Context) {
    ctx.HTML("<h1> Hello from /contact </h1>")
})
```

为了让开发者更容易开发处理程序，`iris` 提供了所有的 `HTTP` 方法。第一个参数是路由路径，第二个可变参数是一个或者多个 `iris.Handler`。所有的 `HTTP` 方法都支持，开发者可以为相同路径的处理程序注册不同的方法。

**示例代码:**

```php
app := iris.New()

// 方法: "GET"
app.Get("/", handler)

// 方法: "POST"
app.Post("/", handler)

// 方法: "PUT"
app.Put("/", handler)

// 方法: "DELETE"
app.Delete("/", handler)

// 方法: "OPTIONS"
app.Options("/", handler)

// 方法: "TRACE"
app.Trace("/", handler)

// 方法: "CONNECT"
app.Connect("/", handler)

// 方法: "HEAD"
app.Head("/", handler)

// 方法: "PATCH"
app.Patch("/", handler)

// 用于所有 HTTP 方法
app.Any("/", handler)

func handler(ctx iris.Context){
    ctx.Writef("Hello from method: %s and path: %s", ctx.Method(), ctx.Path())
}
```

## Router Group

路由分组是很常见的业务，我们实际编写接口时我们需要根据业务为路由分组，一组路由可以用前缀路径分组，**组之间共享相同的中间件和模板布局**，组内可以嵌套组。`.Party` 被用于分组路由，开发者可以声明不限数量的分组。

**示例代码:**

```php
app := iris.New()

users := app.Party("/users", myAuthMiddlewareHandler)

// http://localhost:8080/users/42/profile
users.Get("/{id:int}/profile", userProfileHandler)
// http://localhost:8080/users/messages/1
users.Get("/messages/{id:int}", userMessageHandler)
```

## 路径参数

路径参数类型，出现在路由路径字符串，是一个标志位，类似于正则的命名子模式中的键，其作用间接调用验证器断言请求中的参数，断型不匹配，断言不通过则返回 404。助手方法，从请求参数对象获取对应的参数值。

| 参数类型        | 类型   | 验证器                                                       | 助手方法             |
| --------------- | ------ | ------------------------------------------------------------ | -------------------- |
| `:string`       | string | 任意字符串 (单一路径片段)                                    | Params().Get         |
| `:int`          | int    | -9223372036854775808 to 9223372036854775807 (x64) or -2147483648 to 2147483647 (x32), 取决于主机架构 | `Params().GetInt`    |
| `:int8`         | int8   | -128 to 127                                                  | `Params().GetInt8`   |
| `:int16`        | int16  | -32768 to 32767                                              | `Params().GetInt16`  |
| `:int32`        | int32  | -2147483648 to 2147483647                                    | `Params().GetInt32`  |
| `:int64`        | int64  | -9223372036854775808 to 9223372036854775807                  | `Params().GetInt64`  |
| `:uint`         | uint   | 0 to 18446744073709551615 (x64) or 0 to 4294967295 (x32), 取决于主机架构 | `Params().GetUint`   |
| `:uint8`        | uint8  | 0 to 255                                                     | `Params().GetUint8`  |
| `:uint16`       | uint16 | 0 to 65535                                                   | `Params().GetUint16` |
| `:uint32`       | uint32 | 0 to 4294967295                                              | `Params().GetUint32` |
| `:uint64`       | uint64 | 0 to 18446744073709551615                                    | `Params().GetUint64` |
| `:bool`         | bool   | “1” or “t” or “T” or “TRUE” or “true” or “True” or “0” or “f” or “F” or “FALSE” or “false” or “False” | `Params().GetBool`   |
| `:alphabetical` | string | 小写可大写字母转换                                           | `Params().Get`       |
| `:file`         | string | 用大 / 小字母，数字，下划线 (_), 破折号 (-), 点 (.) 且 无空格或其它对文件名中无效的特定字符 | `Params().Get`       |
| `:path`         | string | 任何字符串，可被反斜杠分割 (路径片段) 路由路径的最末端除外   | `Params().Get`       |

### 用法

`ctx` 实现上下文接口类型实例，其内持有 `net/http` 请求与响应实例，实质是一个组合对象。

```php
app.Get("/users/{id:uint64}", func(ctx iris.Context){
    id := ctx.Params().GetUint64Default("id", 0)
    // [...]
})
```

## 内置函数

内置函数可以被使用在路由路径参数中，中间用空格分开，类似于 linux 管道，一端输入另一端输出

| Built-in Func                                                | Param Types                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `regexp`(expr string)                                        | `:string`                                                    |
| `prefix`(prefix string)                                      | `:string`                                                    |
| `suffix`(suffix string)                                      | `:string`                                                    |
| `contains`(s string)                                         | `:string`                                                    |
| `min`(minValue int or int8 or int16 or int32 or int64 or uint8 or uint16 or uint32 or uint64 or float32 or float64) | `:string(char length)`, `:int, :int8, :int16, :int32, :int64, :uint, :uint8, :uint16, :uint32, :uint64` |
| `max`(maxValue int or int8 or int16 or int32 or int64 or uint8 or uint16 or uint32 or uint64 or float32 or float64) | `:string(char length)`,`:int, :int8, :int16, :int32, :int64, :uint, :uint8, :uint16, :uint32, :uint64` |
| `range`(minValue, maxValue int or int8 or int16 or int32 or int64 or uint8 or uint16 or uint32 or uint64 or float32 or float64) | `:int, :int8, :int16, :int32, :int64, :uint, :uint8, :uint16, :uint32, :uint64` |

### 用法

```php
app.Get("/profile/{name:alphabetical max(255)}", func(ctx iris.Context){
    name := ctx.Params().Get("name")
    // len(name) <=255必须成立 否则路由将触发 404 Not Found
    // 而且本handler将不再被执行
})
```

