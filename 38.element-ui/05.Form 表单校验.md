# Form 表单提交

### 典型表单 — 数据关联

数据结构对应表单model结构，既然我们是使用了vue框架，表单的提交只需要使用axios来实现就行了。

![1570693016964](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1570693016964.png)

```vue
<template>
    <el-form 
        :model="ruleForm" 
        ref="ruleForm" 
        label-width="100px"     //这里表示label的宽度>
        <el-form-item label="昵称">
            <el-input v-model="ruleForm.name"></el-input>
        </el-form-item>
        <el-form-item label="活动区域">
            <el-select v-model="form.region" placeholder="请选择活动区域">
                <el-option label="区域一" value="shanghai"></el-option>
                <el-option label="区域二" value="beijing"></el-option>
                //label指的是显示的，value是传入的值。
            </el-select>
        </el-form-item>
        <el-form-item label="活动性质">
            <el-checkbox-group v-model="form.type">
                <el-checkbox label="美食/餐厅线上活动" name="type"></el-checkbox>
                <el-checkbox label="地推活动" 	 	  name="type"></el-checkbox>
                <el-checkbox label="线下主题活动" 	 name="type"></el-checkbox>
                <el-checkbox label="单纯品牌曝光"	  	 name="type"></el-checkbox>
            </el-checkbox-group> 
        </el-form-item>
        <el-form-item label="特殊资源">
            <el-radio-group v-model="form.resource">
              <el-radio label="线上品牌商赞助"></el-radio>
              <el-radio label="线下场地免费"></el-radio>
            </el-radio-group>
      </el-form-item>
      <el-form-item>
            <el-button @click="register">注册</el-button>
      </el-form-item>   
    </el-form>
</template>
<script>
    export default{
        data(){
            return {
                ruleForm:{
                    name:'',
                    region:'',
                    type:[],
                    resource:''
                }
            }
        },
        methods:{
            register(){
                axios.post('/users/signup',{
                    username:encodeURIComponent(self.ruleForm.name),
                    region:self.ruleForm.region
                })
            }
        }
    }
</script>
```

### 行内表单

当垂直方向空间受限且表单较简单时，可以在一行内放置表单。

![1570692896570](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1570692896570.png)

```vue
设置 inline 属性可以让表单域变为行内的表单域

<el-form :inline="true" :model="formInline" class="demo-form-inline">
  <el-form-item label="审批人">
    <el-input v-model="formInline.user" placeholder="审批人"></el-input>
  </el-form-item>
  <el-form-item label="活动区域">
    <el-select v-model="formInline.region" placeholder="活动区域">
      <el-option label="区域一" value="shanghai"></el-option>
      <el-option label="区域二" value="beijing"></el-option>
    </el-select>
  </el-form-item>
  <el-form-item>
    <el-button type="primary" @click="onSubmit">查询</el-button>
  </el-form-item>
</el-form>
<script>
  export default {
    data() {
      return {
        formInline: {
          user: '',
          region: ''
        }
      
</script>
```

### 对齐方式

**left**

![1570693132769](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1570693132769.png)

**top**

![1570693152711](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1570693152711.png)

```vue
<el-form :label-position="left" label-width="80px" :model="formLabelAlign">
</el-form>
<el-form :label-position="right" label-width="80px" :model="formLabelAlign">
</el-form>
```

> left | top | right

### 表单验证( rules )

Form 组件提供了表单验证的功能，只需要通过 `rules` 属性传入约定的验证规则，并将 Form-Item 的 `prop` 属性设置为需校验的字段名即可。

```vue
<template>
        <section>
            <el-form 
                :model="ruleForm" 
                :rules="rules" 
                ref="ruleForm" 
                label-width="100px" 
                class="demo-ruleForm">
                <el-form-item label="昵称" prop="name">
                    <el-input v-model="ruleForm.name"></el-input>
                </el-form-item>
                <el-form-item label="邮箱" prop="email">
                    <el-input v-model="ruleForm.email" />
                    <el-button 
                        size="mini" 
                        round 
                        @click="sendMsg">发送验证码</el-button>
                        <span class="status">{{ statusMsg }}</span>
                </el-form-item>
                <el-form-item label="验证码" prop="code">
                    <el-input v-model="ruleForm.code" maxlength="4"/>
                </el-form-item>
                <el-form-item label="密码" prop="pwd">
                    <el-input v-model="ruleForm.pwd" type="password"/>
                </el-form-item>
                <el-form-item label="确认密码" prop="cpwd">
                    <el-input v-model="ruleForm.cpwd" type="password"/>
                </el-form-item>            
                <el-form-item>
                    <el-button @click="register">同意以下协议并注册</el-button>
                    <div class="error">{{ error }}</div>
                </el-form-item>     
            </el-form>
        </section>
    </div>
</template>

<script>
import CryptoJS from 'crypto-js'
import axios from 'axios'
export default {
    data(){
        return{
            statusMsg:'',
            ruleForm:{
                name:'',
                code:'',
                email:'',
                pwd:'',
                cpwd:''
            },
            error:'',
            rules:{
                name:[{
                    required:true,type:'string',message:'请输入昵称',trigger:'blur'
                }],
                email:[{
                    required:true,type:'email',message:'请输入邮箱',trigger:'blur',
                }],
                pwd:[{
                    required:true,message:'请输入昵称',trigger:'blur'
                }],
                cpwd:[{
                    requried:true,message:'确认密码',trigger:'blur'
                },{
                    validator:(rule,value,callback)=>{
                        if(value==''){
                            callback(new Error('请再次输入密码'))
                        }else if(value!==this.ruleForm.pwd){
                            callback(new Error('两次密码输入的不一致'))
                        }else{
                            callback()
                        }
                    }
                }]
            }
        }
    },
    methods:{
        sendMsg:function(){
            const self = this
            let namePass 
            let emailPass
            if(self.timerid){
                return false
            }
            this.$refs['ruleForm'].validateField('name',(valid)=>{
                namePass = valid
            })
            self.statusMsg = ''
            if(namePass){
                return false
            }
            this.$refs['ruleForm'].validateField('email',(valid)=>{
                emailPass = valid
            })
            if(!namePass && !emailPass){
                axios.post('/users/verify',{
                    username:encodeURIComponent(self.ruleForm.name),
                    email:self.ruleForm.email
                    }).then(({status,data})=>{
                        if(status === 200 && data && data.code === 0){
                            let count = 60;
                            self.statusMsg = `验证码已发送,剩余${count--}秒`
                            self.timerid = setInterval(function(){
                                self.statusMsg = `验证码已发送,剩余${count--}秒`
                                if(count === 0){
                                    clearInterval(self.timerid)
                                }
                            },1000)
                        }else{
                            self.statusMsg = data.msg
                        }
                    })
               
            }
        },
        register:function(){
            let self = this

            this.$refs.ruleForm.validate((valid) => {
                if(valid){
                    axios.post('/users/signup',{
                        username:window.encodeURIComponent(self.ruleForm.name),
                        password:CryptoJS.MD5(self.ruleForm.pwd).toString(),
                        email:self.ruleForm.email,
                        code:self.ruleForm.code
                    }).then(({status,data})=>{
                        if(status===200){
                            console.log(data)
                            if(data&&data.code===0){
                                location.href = '/login'
                            }else{
                                self.error = `服务器出错，错误码：${status}`
                            }
                        }else{
                            self.error = `服务器出错，错误码：${status}`
                        }
                        setTimeout(function(){
                            self.error = ''
                        },1500)
                    })
                }
            })
        }
    }
}
</script>
```

#### Type

Indicates the `type` of validator to use. Recognised type values are:

- `string`: Must be of type `string`. `This is the default type.`
- `number`: Must be of type `number`.
- `boolean`: Must be of type `boolean`.
- `method`: Must be of type `function`.
- `regexp`: Must be an instance of `RegExp` or a string that does not generate an exception when creating a new `RegExp`.
- `integer`: Must be of type `number` and an integer.
- `float`: Must be of type `number` and a floating point number.
- `array`: Must be an array as determined by `Array.isArray`.
- `object`: Must be of type `object` and not `Array.isArray`.
- `enum`: Value must exist in the `enum`.
- `date`: Value must be valid as determined by `Date`
- `url`: Must be of type `url`.
- `hex`: Must be of type `hex`.
- `email`: Must be of type `email`.

#### Required

The `required` rule property indicates that the field must exist on the source object being validated.

#### Pattern

The `pattern` rule property indicates a regular expression that the value must match to pass validation.

#### Range

A range is defined using the `min` and `max` properties. For `string` and `array` types comparison is performed against the `length`, for `number` types the number must not be less than `min` nor greater than `max`.

#### Length

To validate an exact length of a field specify the `len` property. For `string` and `array` types comparison is performed on the `length` property, for the `number` type this property indicates an exact match for the `number`, ie, it may only be strictly equal to `len`.

If the `len` property is combined with the `min` and `max` range properties, `len` takes precedence.

#### validator 和 asyncValidator

```javascript
var descriptor = {
  name: {
    type: "string",
    required: true,
    validator: (rule, value) => value === 'muji',
  },
  age: {
    type: "number",
    asyncValidator: (rule, value) => {
        return new Promise((resolve, reject) => {
          if (value < 18) {
            reject("too young");  // reject with error message
          } else {
            resolve();
          }
        });
      }
  },
  yehp: {
    type: "number",
    asyncField:{
        asyncValidator(rule,value,callback){
            ajax({
                url:'xx',
                value:value
            }).then(function(data){
                callback();
            },function(error){
                callback(new Error(error))
        });
     }
  }
};
```

> asyncvalidator可以用来异步检测用户名是否存在。

### Form Methods

| 方法名        | 说明                                                         | 参数                                                         |
| :------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| validate      | 对整个表单进行校验的方法，参数为一个回调函数。该回调函数会在校验结束后被调用，并传入两个参数：是否校验成功和未通过校验的字段。若不传入回调函数，则会返回一个 promise | Function(callback: Function(boolean, object))                |
| validateField | 对部分表单字段进行校验的方法                                 | Function(props: array \| string, callback: Function(errorMessage: string)) |
| resetFields   | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果   | —                                                            |
| clearValidate | 移除表单项的校验结果。传入待移除的表单项的 prop 属性或者 prop 组成的数组，如不传则移除整个表单的校验结果 | Function(props: array \| string)                             |

### Form Events

| 事件名称 | 说明                   | 回调参数                                                   |
| :------- | :--------------------- | :--------------------------------------------------------- |
| validate | 任一表单项被校验后触发 | 被校验的表单项 prop 值，校验是否通过，错误消息（如果存在） |

### Form-Item Methods

| 方法名        | 说明                                                 | 参数 |
| :------------ | :--------------------------------------------------- | :--- |
| resetField    | 对该表单项进行重置，将其值重置为初始值并移除校验结果 | -    |
| clearValidate | 移除该表单项的校验结果                               | -    |

#### 实例

```vue
<template>
  <div>
    <el-form ref="ruleForm" :model="ruleForm" :rules="rules">
        el-form-item label="name" prop="name" @validate="onValidate" refs="nameF"
        	el-input v-model="ruleForm.name" 
        el-form-item
        	el-button @click="register"
    </el-form>
  </div>
</template>

<script>
    export default{
        data(){
           	return{
                ruleForm:{
                    name:''
                },
                rules:{ 
                    name:[{
                        required:true,
                        type:'string',
                        message:'请输入昵称',
                        trigger:'blur'
                    }],
                }
            }
        }
        method:{
            onValidate(prop,valid,msg){
                if(!valid){
                    this.$refs['ruleForm'].resetFields()
                    //表单重置。
                }else{
                    this.$refs['nameF'].resetField()
                    //单项表单域校验。
                }
            },
            //表单发生校验的事件。
            register(){
                this.$refs['ruleForm'].validateField('name',(valid)=>{
                    if(valid){
                        axios.get('user/signup')
                    }
                })
                //表单域单项验证。参数一要校验的字段，参数二参数为是否校验成功的回调函数。
            	this.$refs.ruleForm.validate((valid) => {
                    if(valid){
                        axios.get('user/signup')
                    }
                })
                //表单域全验证。参数一为是否校验成功的回调函数。
            },
        }
    }
</script>
```

