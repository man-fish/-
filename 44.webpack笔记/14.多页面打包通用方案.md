# Webpack多页面打包通用方案

> 程序猿和猿最大的区别就是程序猿会使用工具。

实际构建的时候肯定是越方便越好，所以我们不可能就就单纯的新增一个页面就手动添加一个配置，于是以下就是针对于多页面应用（MPA）的打包方案

```shell
$ npm i glob
```

![1573619972146](F:\我的笔记\image\1573619972146.png)

```js
const glob = require("glob")
const path = require("path")
const webpack = require("webpack")
const HTMLWebpackPlugin = require("html-webpack-plugin")
const {CleanWebpackPlugin} = require("clean-webpack-plugin")

const setMap = ()=>{
    const entry = {}
    const htmlwebpackplugins = [];

    const entryFiles = glob.sync(path.join(`${process.cwd()}`,'./src/page/*/index.js'))
    //获取匹配到的入口文件数组。

    entryFiles.map((item)=>{
        //对入口文件数组进行遍历操作
            const entryFile = item;
            const match = entryFile.match(/page\/(.*)\/index\.js/);
            //从拿到的入口文件路径中匹配出入口名。
            const pageName = match && match[1]
            console.log('--pageName',pageName)

            entry[pageName] = entryFile
            htmlwebpackplugins.push(
                new HTMLWebpackPlugin({
                  template:path.join(__dirname,`./../src/page/${pageName}/index.html`),
                    filename:`${pageName}.html`,
                    chunks:pageName,
                    inject:true,
                    minify:{
                        html5:false,
                        collapseWhitespace:false,
                        preserveLineBreaks:false,
                        minifyCSS:true,
                        minifyJS:true,
                        removeComments:true
                    }
                })
            )
        })

    return {
        entry,
        htmlwebpackplugins
    }
}

const {entry,htmlwebpackplugins} = setMap()

module.exports = {
    entry,
    output:{
        path:path.join(__dirname+"./../dist"),
        filename:'[name].js'
    },
    mode:'production',
    module:{
        rules: [
            {
                test: /\.js$/,
                use:"babel-loader"
            },
            {
                test: /\.css$/,
                use:[
                    "style-loader",
                    "css-loader"
                ]
            },
            {
                test:/\.less$/,
                use:[
                    "style-loader",
                    "css-loader",
                    "less-loader"
                ]
            },
            {
                test:/.(png|jpg|gif|jpeg)$/,
                use:[{
                        loader:"url-loader",
                        options:{
                            limit:102400
                        }
                }]
            },
            {
                test:/.(woff|woff2|eot|ttf|otf)$/,
                use:[
                    "file-loader"
                ]
            }
        ]
    },    
    plugins: [
        new webpack.HotModuleReplacementPlugin(),
        new CleanWebpackPlugin()
    ].concat(htmlwebpackplugins)
}
```

```js
const glob = require("glob")
const path = require("path")
const webpack = require("webpack")
const HTMLWebpackPlugin = require("html-webpack-plugin")
const {CleanWebpackPlugin} = require("clean-webpack-plugin")

const setMap = ()=>{
    const entry = {}
    const htmlwebpackplugins = [];

    const entryFiles = glob.sync(path.join(`${process.cwd()}`,'./src/page/*/index.js'))
    //获取匹配到的入口文件数组。

    // Object.keys(entryFiles)
    //     .map((index)=>{
    //         const entryFile = entryFiles[index];
    //         const match = entryFile.match(/page\/(.*)\/index\.js/);
    //         const pageName = match && match[1]
    //         console.log('pageName',pageName)

    //         entry[pageName] = entryFile
    //         htmlwebpackplugins.push(
    //             new HTMLWebpackPlugin({
    //                 template:path.join(__dirname,`./../src/page/${pageName}/index.html`),
    //                 filename:`${pageName}.html`,
    //                 chunks:pageName,
    //                 inject:true,
    //                 minify:{
    //                     html5:false,
    //                     collapseWhitespace:false,
    //                     preserveLineBreaks:false,
    //                     minifyCSS:true,
    //                     minifyJS:true,
    //                     removeComments:true
    //                 }
    //             })
    //         )
    //     })

    return {
        entry,
        htmlwebpackplugins
    }
}

const {entry,htmlwebpackplugins} = setMap()

module.exports = {
    entry,
    output:{
        path:path.join(__dirname+"./../dist"),
        filename:'[name].js'
    },
    mode:'production',
    module:{
        rules: [
            {
                test: /\.js$/,
                use:"babel-loader"
            },
            {
                test: /\.css$/,
                use:[
                    "style-loader",
                    "css-loader"
                ]
            },
            {
                test:/\.less$/,
                use:[
                    "style-loader",
                    "css-loader",
                    "less-loader"
                ]
            },
            {
                test:/.(png|jpg|gif|jpeg)$/,
                use:[{
                        loader:"url-loader",
                        options:{
                            limit:102400
                        }
                }]
            },
            {
                test:/.(woff|woff2|eot|ttf|otf)$/,
                use:[
                    "file-loader"
                ]
            }
        ]
    },    
    plugins: [
        new webpack.HotModuleReplacementPlugin(),
        new CleanWebpackPlugin()
    ].concat(htmlwebpackplugins)
}
```

