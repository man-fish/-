# Webpack source-map调试

## JavaScript Source Map 详解

#### 引言

上周，[jQuery 1.9](http://blog.jquery.com/2013/01/15/jquery-1-9-final-jquery-2-0-beta-migrate-final-released/)发布。

![img](https://www.ruanyifeng.com/blogimg/asset/201301/bg2013012203.png)

这是2.0版之前的最后一个新版本，有很多新功能，其中一个就是支持Source Map，访问 http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js，打开压缩后的版本，滚动到底部，你可以看到最后一行是这样的：

> 　　//@ sourceMappingURL=jquery.min.map

这就是Source Map。它是一个独立的map文件，与源码在同一个目录下，你可以[点击进去](http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.map)，看看它的样子。

这是一个很有用的功能，本文将详细讲解这个功能。

#### **一、从源码转换讲起**

JavaScript脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。

常见的源码转换，主要是以下三种情况：

> 　　（1）压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。
>
> 　　（2）多个文件合并，减少HTTP请求数。
>
> 　　（3）其他语言编译成JavaScript。最常见的例子就是CoffeeScript。

这三种情况，都使得实际运行的代码不同于开发代码，除错（debug）变得困难重重。通常，JavaScript的解释器会告诉你，第几行第几列代码出错。但是，这对于转换后的代码毫无用处。举例来说，jQuery 1.9压缩后只有3行，每行3万个字符，所有内部变量都改了名字。你看着报错信息，感到毫无头绪，根本不知道它所对应的原始位置。这就是Source map想要解决的问题。

#### 二、什么是Source map

简单说，Source map就是一个信息文件，里面储存着位置信息。也就是说，转换后的代码的每一个位置，所对应的转换前的位置。

有了它，出错的时候，除错工具将直接显示原始代码，而不是转换后的代码。这无疑给开发者带来了很大方便。

![img](https://www.ruanyifeng.com/blogimg/asset/201301/bg2013012204.png)

目前，暂时只有Chrome浏览器支持这个功能。在Developer Tools的Setting设置中，确认选中"Enable source maps"。

![img](https://www.ruanyifeng.com/blogimg/asset/201301/bg2013012201.png)

#### 三、如何启用Source map

正如前文所提到的，只要在转换后的代码尾部，加上一行就可以了。

> 　　//@ sourceMappingURL=/path/to/file.js.map

map文件可以放在网络上，也可以放在本地文件系统。

## 在webpack中使用source map

webpack的sourcemap是在开发环境下使用的，所以说你的exvironment选项最好是侬额，然后再devtoo关键字里面加上对应的source选项即可。

#### 关键字

> eval：打包之后不生成.map文件，将文件用eval包裹放到编译好的入口文件中。
>
> source map：生成.map文件。
>
> inline：将。map文件使用DataURL嵌入，默认是不生成.map文件。
>
> cheap：只包含列信息。

#### 排列组合

![1573621386933](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1573621386933.png)

#### 常用配置

```json
{
	devtool:'source-map'
    //打印入口文件源码
}
```

#### 实际效果

**开启前（错误难以排查）**

![1573622612600](F:\我的笔记\image\1573622612600.png)

**开启后（显示原来的js文件）**

![1573622737073](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1573622737073.png)