

# async和await

## 概念

> await其实是一个求值表达式，return fullfilled状态下，异步函数的值。
>
> async包装的函数会返回一个promise对象。

```js
<!--
  async函数(源自ES2017)
  概念： 真正意义上去解决异步回调的问题，同步流程表达异步操作
  本质： Generator的语法糖
  语法：
      async function foo(){
        await 异步操作;
        await 异步操作；
      }
  特点：
    1、不需要像Generator去调用next方法，遇到await等待，当前的异步操作完成就往下执行
    2、返回的总是Promise对象，可以用then方法进行下一步操作
    3、async取代Generator函数的星号*，await取代Generator的yield
    4、语意上更为明确，使用简单，经临床验证，暂时没有任何副作用
    5、因为await内需要异步操作，并且要判断异步操作的状态，于是promise
  promise基础：
    1. 理解:
         * Promise对象: 代表了未来某个将要发生的事件(通常是一个异步操作)
    2. 使用promise基本步骤(2步):
         * 创建promise对象
            let promise = new Promise((resolve, reject) => {
                    //初始化promise状态为 pending
              //执行异步操作
                  if(异步操作成功) {
                        resolve(value);//修改promise的状态为fullfilled
                  } else {
                        reject(errMsg);//修改promise的状态为rejected
                  }
            })
    3. promise对象的3个状态
          * pending: 初始化状态
          * fullfilled: 成功状态
          * rejected: 失败状态
-->
```

## 实例

```js
	async function pro1(){
		return new Promise(resolve=>{
			console.log("异步函数1完成")
			resolve("异步函数2完成")
            //async函数会自动判断promise的执行状态，并且从resolve中接收参数。
		})
	}
	function pro2(cot){
		console.log(cot)
	}
	async function mossionStrack(){
		let content = await pro1()
	
		await pro2(content)
	}
	mossionStrack()
```

<https://www.jb51.net/article/115967.htm>

<https://www.jianshu.com/p/2f9a6692778a>

<https://www.cnblogs.com/lalalagq/p/9824382.html>

## 注意

await只能求出fullfilled状态下异步函数返回的值，对于reject的值我们需要在异步函数后面进行捕获，否则就会报错Uncaught（in Promise）。

![clipboard.png](https://segmentfault.com/img/bVM6YZ?w=542&h=279)

```js
class HTTP{
    async request({url,type="GET",dataType='json',data={}}){
        return new Promise((resolve,reject)=>{
            this._request(url,type,dataType,data,resolve,reject)
        }).catch(function(reason) {
            console.log('出问题啦：', reason);
        });
    }
```

> 所以说作为一个好习惯，一定要在promise后面加上catch语句。